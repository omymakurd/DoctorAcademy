{% extends "dashboards/instructor_base.html" %}
{% load static %}
{% load widget_tweaks %}

{% block title %}Add Quiz | Instructor Dashboard{% endblock %}

{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Tajawal:wght@300;400;700&display=swap" rel="stylesheet">

<style>
  body { font-family: 'Tajawal', sans-serif; }
  h1,h2,h3,h4,h5,h6 { font-family: 'Poppins', sans-serif; }

  .card-custom {
    background: #fff;
    border-radius: 18px;
    padding: 30px;
    box-shadow: 0 2px 20px rgba(0,0,0,0.06);
  }

  .form-control, .form-select {
    border-radius: 12px;
    padding: 12px;
    border: 1px solid #d3dce6;
  }
  .form-control:focus, .form-select:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 0 4px rgba(13,110,253,0.15);
  }
</style>

<div class="container mt-5 mb-5">
  <div class="card-custom">
    <h2 class="fw-bold mb-4">â• Add Quiz for Lecture: {{ lecture.title }}</h2>

    <form id="quizForm" method="POST">
      {% csrf_token %}
      <div class="row g-3">
        <!-- Question -->
        <div class="col-12">
          <label class="form-label fw-bold">Question</label>
          {{ quiz_form.question|add_class:"form-control" }}
        </div>

        <!-- Option 1 -->
        <div class="col-md-6">
          <label class="form-label fw-bold">Option 1</label>
          {{ quiz_form.option1|add_class:"form-control" }}
        </div>

        <!-- Option 2 -->
        <div class="col-md-6">
          <label class="form-label fw-bold">Option 2</label>
          {{ quiz_form.option2|add_class:"form-control" }}
        </div>

        <!-- Option 3 -->
        <div class="col-md-6">
          <label class="form-label fw-bold">Option 3</label>
          {{ quiz_form.option3|add_class:"form-control" }}
        </div>

        <!-- Option 4 -->
        <div class="col-md-6">
          <label class="form-label fw-bold">Option 4</label>
          {{ quiz_form.option4|add_class:"form-control" }}
        </div>

        <!-- Correct Answer -->
        <div class="col-12">
          <label class="form-label fw-bold">Correct Answer</label>
          {{ quiz_form.correct_answer|add_class:"form-select" }}
        </div>

        <!-- Submit Button -->
        <div class="col-12">
          <button type="submit" class="btn btn-primary w-100 mt-3">ğŸ’¾ Save Question</button>
        </div>
      </div>
    </form>

    <!-- Success Modal -->
    <div class="modal fade" id="quizSuccessModal" tabindex="-1" aria-labelledby="quizSuccessModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="quizSuccessModalLabel">âœ… Question Saved!</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            Ø§Ù„Ø³Ø¤Ø§Ù„ ØªÙ… Ø­ÙØ¸Ù‡ Ø¨Ù†Ø¬Ø§Ø­! Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¢Ø®Ø±ØŸ
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ù„Ø§ØŒ Ø§Ù†ØªÙ‡ÙŠØª</button>
            <button type="button" id="addAnotherQuizBtn" class="btn btn-primary">â• Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¢Ø®Ø±</button>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const form = document.getElementById("quizForm");

  form.addEventListener("submit", function(e){
    e.preventDefault();
    let formData = new FormData(this);

    fetch("{% url 'lectures:add_quiz' lecture.id %}", {
      method: "POST",
      headers: {'X-CSRFToken': '{{ csrf_token }}', 'X-Requested-With': 'XMLHttpRequest'},
      body: formData
    })
    .then(res => res.json())
    .then(data => {
      if(data.success){
        const modal = new bootstrap.Modal(document.getElementById('quizSuccessModal'));
        modal.show();

        document.getElementById('addAnotherQuizBtn').onclick = function(){
          modal.hide();
          form.reset();
        }

      } else {
        alert("âŒ Errors: " + JSON.stringify(data.errors));
      }
    })
    .catch(err => console.error(err));
  });
});
</script>

{% endblock %}
