{% extends "base.html" %}
{% load static %}

{% block title %}{{ module.title }}{% endblock %}

{% block content %}
<div class="container py-4">

    <!-- Module Header -->
    <div class="row">
        <div class="col-md-4">
            {% if module.thumbnail %}
                <img src="{{ module.thumbnail.url }}" class="img-fluid rounded shadow" alt="{{ module.title }}">
            {% else %}
                <img src="{% static 'images/default-module.jpg' %}" class="img-fluid rounded shadow" alt="No Image">
            {% endif %}
        </div>

        <div class="col-md-8">
            <h2 class="fw-bold">{{ module.title }}</h2>

            <p class="text-muted mb-1">
                {% if module.basic_system %}
                    {{ module.basic_system.category.name }} â†’ {{ module.basic_system.name }}
                {% elif module.clinical_system %}
                    Clinical: {{ module.clinical_system.name }}
                {% else %}
                    No system assigned
                {% endif %}
            </p>

            {% if module.description %}
            <p>{{ module.description }}</p>
            {% endif %}

            <h4 class="text-primary mt-3">{{ module.price }} $</h4>

            <!-- Purchase or Start -->
{% if user.is_authenticated %}

    {% if module.price == 0 %}
        <!-- Free Module -->
        <a href="{% url 'lectures:module_learning' module.id %}" class="btn btn-success btn-lg">
            Start Learning
        </a>

    {% elif user_enrolled %}
        <!-- Already purchased -->
        <a href="{% url 'lectures:module_learning' module.id %}" class="btn btn-success btn-lg">
            Start Learning
        </a>

    {% else %}
        <!-- Paid Module -->
        <a href="{% url 'lectures:module_checkout' module.id %}" class="btn btn-primary btn-lg">
            Buy Module
        </a>
    {% endif %}

{% else %}
    {% if module.price == 0 %}
        <a href="/login/" class="btn btn-outline-success btn-lg">Login to Start Free</a>
    {% else %}
        <a href="/login/" class="btn btn-outline-primary btn-lg">Login to Purchase</a>
    {% endif %}
{% endif %}



        </div>
    </div>

    <hr class="my-4">

    <!-- Lectures List -->
    <h4 class="fw-bold">Lectures</h4>

{% if module.basiclectures.exists or module.clinicallectures.exists %}
   <ul class="list-group">

{% for lecture in module.basiclectures.all %}
<li class="list-group-item d-flex justify-content-between align-items-center">
    <strong>{{ lecture.title }}</strong>
    {% if user.is_authenticated %}
    <a href="{% url 'lectures:lecture_learning' 'basic' lecture.id %}" class="btn btn-sm btn-outline-primary">View</a>
    {% else %}
    <a href="{% url 'login' %}" class="btn btn-sm btn-outline-primary">Login</a>
    {% endif %}
</li>
{% endfor %}

{% for lecture in module.clinicallectures.all %}
<li class="list-group-item d-flex justify-content-between align-items-center">
    <strong>{{ lecture.title }}</strong>
    {% if user.is_authenticated %}
    <a href="{% url 'lectures:lecture_learning' 'clinical' lecture.id %}" class="btn btn-sm btn-outline-primary">View</a>
    {% else %}
    <a href="{% url 'login' %}" class="btn btn-sm btn-outline-primary">Login</a>
    {% endif %}
</li>
{% endfor %}

</ul>

{% else %}
    <p class="text-muted">No lectures available yet.</p>
{% endif %}


</div>
{% endblock %}
