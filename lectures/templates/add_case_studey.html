{% extends "dashboards/instructor_base.html" %}
{% load static %}
{% load widget_tweaks %}

{% block title %}Add Case Study | Instructor Dashboard{% endblock %}

{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Tajawal:wght@300;400;700&display=swap" rel="stylesheet">

<style>
  body { font-family: 'Tajawal', sans-serif; }
  h1,h2,h3,h4,h5,h6 { font-family: 'Poppins', sans-serif; }

  .card-custom {
    background: #fff;
    border-radius: 18px;
    padding: 30px;
    box-shadow: 0 2px 20px rgba(0,0,0,0.06);
  }

  .form-control, .form-select {
    border-radius: 12px;
    padding: 12px;
    border: 1px solid #d3dce6;
  }
  .form-control:focus, .form-select:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 0 4px rgba(13,110,253,0.15);
  }
</style>

<div class="container mt-5 mb-5">
  <div class="card-custom">
    <h2 class="fw-bold mb-4">â• Add Case Study for Lecture: {{ lecture.title }}</h2>

    <form id="caseForm" method="POST" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="row g-3">

        <!-- Case Title -->
        <div class="col-12">
          <label class="form-label fw-bold">Case Title</label>
          {{ case_form.title|add_class:"form-control" }}
        </div>

        <!-- Case Description -->
        <div class="col-12">
          <label class="form-label fw-bold">Description / Instructions</label>
          {{ case_form.description|add_class:"form-control" }}
        </div>

        <!-- Attach Files (Optional) -->
        <div class="col-12">
          <label class="form-label fw-bold">Attach File(s) (optional)</label>
          {{ case_form.attachment|add_class:"form-control" }}
        </div>

        <!-- Submit Button -->
        <div class="col-12">
          <button type="submit" class="btn btn-success w-100 mt-3">ğŸ’¾ Save Case Study</button>
        </div>

      </div>
    </form>

    <!-- Success Modal -->
    <div class="modal fade" id="caseSuccessModal" tabindex="-1" aria-labelledby="caseSuccessModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="caseSuccessModalLabel">âœ… Case Study Saved!</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            Ø§Ù„Ù€ Case Study ØªÙ… Ø­ÙØ¸Ù‡ Ø¨Ù†Ø¬Ø§Ø­! Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØ© Case Study Ø¢Ø®Ø±ØŸ
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ù„Ø§ØŒ Ø§Ù†ØªÙ‡ÙŠØª</button>
            <button type="button" id="addAnotherCaseBtn" class="btn btn-success">â• Ø¥Ø¶Ø§ÙØ© Ø¢Ø®Ø±</button>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const form = document.getElementById("caseForm");

  form.addEventListener("submit", function(e){
    e.preventDefault();
    let formData = new FormData(this);

    fetch("{% url 'lectures:add_case_study' lecture.id %}", {
      method: "POST",
      headers: {'X-CSRFToken': '{{ csrf_token }}', 'X-Requested-With': 'XMLHttpRequest'},
      body: formData
    })
    .then(res => res.json())
    .then(data => {
      if(data.success){
        const modal = new bootstrap.Modal(document.getElementById('caseSuccessModal'));
        modal.show();

        document.getElementById('addAnotherCaseBtn').onclick = function(){
          modal.hide();
          form.reset();
        }

      } else {
        alert("âŒ Errors: " + JSON.stringify(data.errors));
      }
    })
    .catch(err => console.error(err));
  });
});
</script>

{% endblock %}
