{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container py-5">

  <h2 class="fw-bold text-center mb-4">Shopping Cart</h2>

  {% if order and order.orderitem_set.exists %}
  <div class="table-responsive shadow-sm rounded">
    <table class="table align-middle">
      <thead class="table-light">
        <tr>
          <th>Product</th>
          <th class="text-center">Quantity</th>
          <th class="text-end">Price</th>
          <th class="text-end">Subtotal</th>
          <th class="text-end"></th>
        </tr>
      </thead>
      <tbody>

        {% for item in order.orderitem_set.all %}
        <tr>
          <td>
            <div class="d-flex align-items-center gap-2">
              {% if item.product.image %}
                <img src="{{ item.product.image.url }}" width="55" height="55" class="rounded" style="object-fit:cover;">
              {% endif %}
              {{ item.product.name }}
            </div>
          </td>

          <td class="text-center">
            <form action="{% url 'update_quantity' item.id %}" method="POST" class="d-inline">
              {% csrf_token %}
              <button name="action" value="decrease" class="btn btn-sm btn-light">-</button>
              <span class="mx-2 fw-semibold">{{ item.quantity }}</span>
              <button name="action" value="increase" class="btn btn-sm btn-light">+</button>
            </form>
          </td>

          <td class="text-end">${{ item.product.final_price }}</td>

          <td class="text-end fw-semibold">${{ item.subtotal }}</td>

          <td class="text-end">
            <form action="{% url 'remove_from_cart' item.id %}" method="POST">
              {% csrf_token %}
              <button class="btn btn-sm btn-outline-danger">
                <i class="bi bi-trash"></i>
              </button>
            </form>
          </td>

        </tr>
        {% endfor %}

      </tbody>
    </table>
  </div>

  <div class="text-end mt-4">
    <h4>Total: <span class="text-success">${{ order.total_amount }}</span></h4>

<a href="{% url 'checkout_store' %}" class="btn btn-dark btn-lg mt-3">Checkout</a>
  </div>

  {% else %}

  <div class="text-center py-5">
    <img src="{% static 'images/empty-cart.png' %}" class="mb-4" width="180">
    <h5>Your shopping cart is empty</h5>
    <a href="{% url 'store_home' %}" class="btn btn-primary mt-3">Continue Shopping</a>
  </div>

  {% endif %}

</div>
{% endblock %}
