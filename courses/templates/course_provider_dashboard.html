{% extends "dashboards/provider_base.html" %}
{% load static %}

{% block title %}Dashboard - Doctor Academy{% endblock %}

<link rel="stylesheet" href="{% static 'css/providor.css' %}">

{% block extra_head %}
{% endblock %}

{% block content %}
<h2 class="mb-4" style="font-weight:700;">Welcome, {{ user.username }}!</h2>

<!-- Stats Cards -->
<div class="stats-cards">
  <div class="stats-card">
    <h5>Total Courses</h5>
    <p>{{ total_courses }}</p>
  </div>
  <div class="stats-card">
    <h5>Total Enrollments</h5>
    <p>{{ total_enrollments }}</p>
  </div>
  <div class="stats-card">
    <h5>Total Revenue</h5>
    <p>${{ total_revenue }}</p>
  </div>
  <div class="stats-card">
    <h5>Active Students</h5>
    <p>{{ total_students }}</p>
  </div>
</div>

<!-- Latest Courses Table -->
<div class="table-container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5 style="font-weight:600;">Your Courses</h5>
    <a href="{% url 'courses:course-create' %}" class="btn btn-primary">
      <i class="bi bi-plus-lg"></i> Add Course
    </a>
  </div>

  <table class="table">
    <thead>
      <tr>
        <th>#</th>
        <th>Course Name</th>
        <th>Enrollments</th>
        <th>Revenue</th>
        <th>Status</th>
        <th style="width:230px;">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for course in latest_courses %}
      <tr id="course-row-{{ course.id }}">
        <td>{{ forloop.counter }}</td>
        <td>{{ course.title }}</td>
        <td>{{ course.enrollments_count }}</td>
        <td>${{ course.revenue }}</td>
        <td>
          {% if course.is_active %}
            <span class="badge-active">Active</span>
          {% else %}
            <span class="badge-inactive">Inactive</span>
          {% endif %}
        </td>
        <td>
          <a href="{% url 'courses:course-units' course.id %}" class="btn btn-outline-primary btn-sm">Manage Units</a>
          <a href="{% url 'courses:course-edit' course.id %}" class="btn btn-outline-warning btn-sm">Edit</a>
          <button type="button" class="btn btn-outline-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal{{ course.id }}">
            Delete
          </button>
        </td>
      </tr>

      <!-- Delete Modal -->
      <div class="modal fade" id="deleteModal{{ course.id }}" tabindex="-1" aria-labelledby="deleteModalLabel{{ course.id }}" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="deleteModalLabel{{ course.id }}">Confirm Delete</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              Are you sure you want to delete <strong>{{ course.title }}</strong>?
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-danger delete-course-btn" data-course-id="{{ course.id }}">
                Yes, Delete
              </button>
            </div>
          </div>
        </div>
      </div>
      {% empty %}
      <tr>
        <td colspan="6" class="text-center">No courses found.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Link to external JS -->
<script src="{% static 'js/course_delete.js' %}"></script>

{% endblock %}
