{% extends "base.html" %}
{% load dict_extras %}

{% block content %}
<style>
.quiz-result-container {
    max-width: 850px;
    margin: auto;
    background: #fff;
    padding: 35px;
    border-radius: 16px;
    box-shadow: 0 8px 35px rgba(0,0,0,0.08);
}
.result-header {
    text-align: center;
    margin-bottom: 30px;
}
.result-header h2 {
    font-size: 32px;
    font-weight: 700;
}
.result-score {
    font-size: 42px;
    font-weight: 800;
    margin: 10px 0;
}
.pass { color: #34c759; }
.fail { color: #ff3b30; }

.question-box {
    background: #f9fafc;
    border-radius: 12px;
    padding: 18px;
    margin-bottom: 18px;
    border-left: 6px solid #dcdcdc;
}
.correct {
    border-left-color: #34c759;
}
.wrong {
    border-left-color: #ff3b30;
}
.question-text {
    font-weight: 600;
    margin-bottom: 6px;
}
.answer-right { color: #34c759; font-weight: 600; }
.answer-wrong { color: #ff3b30; font-weight: 600; }

.retake-box {
    text-align: center;
    margin-top: 25px;
}
.retake-btn {
    background: #007bff;
    padding: 12px 22px;
    border-radius: 8px;
    color: white;
    font-size: 17px;
    text-decoration: none;
    display: inline-block;
    transition: 0.25s;
}
.retake-btn:hover {
    background: #0056d2;
}
.progress-wrapper {
    width: 100%;
    background: #e6e9f0;
    border-radius: 50px;
    height: 18px;
    margin: 15px 0 25px;
    overflow: hidden;
}
.progress-bar {
    height: 100%;
    width: 0%;
    border-radius: 50px;
    transition: width 1.4s ease-out;
}
.pass-bar { background: #34c759; }
.fail-bar { background: #ff3b30; }

</style>

<div class="quiz-result-container">

    <div class="result-header">
        <h2>üìä Quiz Result</h2>
        <div class="progress-wrapper">
    <div class="progress-bar {% if passed %}pass-bar{% else %}fail-bar{% endif %}"
        style="width: {{ percentage }}%;"></div>
</div>

<div style="text-align:center; font-weight:600; margin-bottom:20px;">
    {{ percentage }}%
</div>

        <div class="result-score {% if passed %}pass{% else %}fail{% endif %}">
            {{ score }} / {{ total }}
        </div>

        {% if passed %}
            <p class="pass">‚úî Congratulations! You passed üéâ</p>
        {% else %}
            <p class="fail">‚úñ You did not pass. Try again üí™</p>
        {% endif %}
    </div>

    <hr>

    {% for question in correct_answers %}
        {% with user_answer=user_answers|get_item:question.id correct_answer=correct_answers|get_item:question.id %}
        <div class="question-box {% if user_answer == correct_answer %}correct{% else %}wrong{% endif %}">
            <div class="question-text">{{ question.text }}</div>

            <div>Your answer:
                <span class="{% if user_answer == correct_answer %}answer-right{% else %}answer-wrong{% endif %}">
                    {{ user_answer }}
                </span>
            </div>

            <div>Correct answer: <span class="answer-right">{{ correct_answer }}</span></div>

        </div>
        {% endwith %}
    {% endfor %}

    <div class="retake-box">
        {% if remaining_attempts > 0 %}
            <p>You have <strong>{{ remaining_attempts }}</strong> retake(s) left.</p>
            <a href="{% url 'quiz' quiz.id %}" class="retake-btn">üîÅ Retake Quiz</a>
        {% else %}
            <p style="color:#ff3b30;">You have no attempts left.</p>
        {% endif %}
    </div>

</div>

<!-- üéâ CONFETTI SCRIPT -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1"></script>
<script>
if ("{{ passed }}" === "True") {
    confetti({
        particleCount: 200,
        spread: 80,
        startVelocity: 40,
        origin: { y: 0.6 }
    });
}
</script>

{% endblock %}
