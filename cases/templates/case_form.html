<form method="POST" enctype="multipart/form-data"
      action="{% if form.instance.id %}
                 {% url 'cases_new:edit' form.instance.id %}
              {% else %}
                 {% url 'cases_new:create' %}
              {% endif %}">
    {% csrf_token %}
    <input type="hidden" name="id" value="{{ form.instance.id }}">

    <!-- ====================== BASIC INFO ====================== -->
    <h4 class="mt-3 mb-3">Basic Information</h4>

    <div class="mb-3">
        <label for="{{ form.title.id_for_label }}" class="form-label">Title</label>
        {{ form.title }}
        <div class="text-danger">{{ form.title.errors }}</div>
    </div>

    <div class="mb-3">
        <label for="{{ form.discipline.id_for_label }}" class="form-label">Discipline</label>
        {{ form.discipline }}
        <div class="text-danger">{{ form.discipline.errors }}</div>
    </div>

    <div class="mb-3">
        <label for="{{ form.target_level.id_for_label }}" class="form-label">Level</label>
        {{ form.target_level }}
        <div class="text-danger">{{ form.target_level.errors }}</div>
    </div>

    <div class="mb-3">
        <label for="{{ form.description.id_for_label }}" class="form-label">Description</label>
        {{ form.description }}
        <div class="text-danger">{{ form.description.errors }}</div>
    </div>

    <div class="mb-3">
        <label for="{{ form.learning_objectives.id_for_label }}" class="form-label">Learning Objectives</label>
        {{ form.learning_objectives }}
        <div class="text-danger">{{ form.learning_objectives.errors }}</div>
    </div>

    <!-- ====================== ATTACHMENTS ====================== -->
    <h4 class="mt-4 mb-3">Attachments</h4>

    <div class="mb-3">
        <label for="{{ form.pdf_file.id_for_label }}" class="form-label">PDF File</label>
        {{ form.pdf_file }}
        <div class="text-danger">{{ form.pdf_file.errors }}</div>
    </div>

    <div class="mb-3">
        <label for="{{ form.image_file.id_for_label }}" class="form-label">Image File</label>
        {{ form.image_file }}
        <div class="text-danger">{{ form.image_file.errors }}</div>
    </div>

    <div class="mb-3">
        <label for="{{ form.thumbnail.id_for_label }}" class="form-label">Thumbnail</label>
        {{ form.thumbnail }}
        <div class="text-danger">{{ form.thumbnail.errors }}</div>
        <img id="thumbPreview" src="{% if form.instance.thumbnail %}{{ form.instance.thumbnail.url }}{% endif %}"
             class="img-fluid mt-2" style="max-height:200px; display:{% if form.instance.thumbnail %}block{% else %}none{% endif %};">
    </div>

    <!-- ====================== PAYMENT ====================== -->
    <h4 class="mt-4 mb-3">Payment Options</h4>

    <div class="form-check form-switch mb-3">
        {{ form.is_paid }}
        <label class="form-check-label" for="{{ form.is_paid.id_for_label }}">Is Paid?</label>
        <div class="text-danger">{{ form.is_paid.errors }}</div>
    </div>

    <div class="mb-3" id="priceField">
        <label for="{{ form.price.id_for_label }}" class="form-label">Price (USD)</label>
        {{ form.price }}
        <div class="text-danger">{{ form.price.errors }}</div>
    </div>

    <!-- ====================== SESSION ====================== -->
    <h4 class="mt-4 mb-3">Session Details</h4>

    <div class="mb-3">
        <label for="{{ form.session_date.id_for_label }}" class="form-label">Session Date</label>
        {{ form.session_date }}
        <div class="text-danger">{{ form.session_date.errors }}</div>
    </div>

    <div class="mb-3">
        <label for="{{ form.session_time.id_for_label }}" class="form-label">Session Time</label>
        {{ form.session_time }}
        <div class="text-danger">{{ form.session_time.errors }}</div>
    </div>

   

    <!-- ====================== FOOTER ====================== -->
    <div class="mt-4 d-flex justify-content-end">
        <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary">{{ action }}</button>
    </div>
</form>

<!-- ====================== SCRIPT ====================== -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    // Thumbnail preview
    const thumbnailInput = document.getElementById("id_thumbnail");
    const thumbPreview = document.getElementById("thumbPreview");
    thumbnailInput?.addEventListener("change", function(event){
        const file = event.target.files[0];
        if(file){
            thumbPreview.src = URL.createObjectURL(file);
            thumbPreview.style.display = "block";
        }
    });

    // Show/Hide price field
    const isPaidInput = document.getElementById("id_is_paid");
    const priceField = document.getElementById("priceField");

    function togglePriceField() {
        if(isPaidInput?.checked){
            priceField.style.display = "block";
        } else {
            priceField.style.display = "none";
        }
    }

    // ضبط عند التحميل الأولي
    togglePriceField();

    // التغيير عند الضغط على checkbox
    isPaidInput?.addEventListener("change", togglePriceField);
});
</script>
